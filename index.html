<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebView Security Test</title>
    <style>
        body { font-family: Arial, sans-serif; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>WebView Security Test</h1>
    <h3>Results:</h3>
    <pre id="results">Running tests...</pre>
    
    <script>
        (async function() {
            let results = [];

            // 1. Test Camera Access
            try {
                await navigator.mediaDevices.getUserMedia({ video: true });
                results.push("❌ Camera access allowed without explicit user interaction!");
            } catch (e) {
                results.push("✅ Camera access requires user permission.");
            }

            // 2. Clipboard Access
            try {
                let clipboardText = await navigator.clipboard.readText();
                results.push(`❌ Clipboard access allowed! Content: "${clipboardText}"`);
            } catch (e) {
                results.push("✅ Clipboard access blocked or requires user action.");
            }

            // 3. JavaScript Execution & Injection
            try {
                eval("alert('XSS Test')");
                results.push("❌ JavaScript eval() execution allowed, potential XSS risk.");
            } catch (e) {
                results.push("✅ JavaScript eval() execution restricted.");
            }

            // 4. CORS Bypass Test
            try {
                await fetch("https://crossorigin.me/http://example.com");
                results.push("❌ CORS misconfiguration detected!");
            } catch (e) {
                results.push("✅ CORS protection enabled.");
            }

            // 5. User-Agent & Environment Detection
            results.push("User-Agent: " + navigator.userAgent);

            // 6. Storage Access
            try {
                localStorage.setItem("test", "123");
                let storageTest = localStorage.getItem("test");
                results.push(storageTest ? "❌ LocalStorage accessible: " + storageTest : "✅ LocalStorage access blocked.");
                localStorage.removeItem("test");
            } catch (e) {
                results.push("✅ LocalStorage access blocked.");
            }

            // 7. UXSS Simulation
            try {
                let frame = document.createElement("iframe");
                frame.src = "javascript:alert('UXSS Test')";
                document.body.appendChild(frame);
                results.push("❌ UXSS vulnerability detected!");
            } catch (e) {
                results.push("✅ UXSS protection enabled.");
            }

            // 8. Pop-up Handling Test
            try {
                let newWin = window.open("about:blank");
                if (newWin) {
                    results.push("❌ Pop-up allowed without user interaction.");
                } else {
                    results.push("✅ Pop-ups blocked by default.");
                }
            } catch (e) {
                results.push("✅ Pop-up restrictions applied.");
            }

            // 9. Clickjacking Test
            let frameProtection = window.self === window.top;
            results.push(frameProtection ? "✅ Clickjacking protection enabled." : "❌ Clickjacking possible!");

            // 10. Service Worker Test with Details
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        results.push(`✅ Service workers detected: ${registrations.length} active workers.`);
                    } else {
                        results.push("❌ No active service workers detected, consider implementing for security enhancements.");
                    }
                    displayResults();
                });
            } else {
                results.push("❌ Service workers not supported in this browser.");
            }

            // 11. HTTPS Enforcement Test
            if (location.protocol !== 'https:') {
                results.push("❌ Not running on HTTPS, potential MITM risk!");
            } else {
                results.push("✅ Running on HTTPS, secure communication ensured.");
            }

            // 12. Cookie Security Flags Test
            document.cookie = "test=123; Secure; HttpOnly; SameSite=Strict";
            if (document.cookie.includes("test=123")) {
                results.push("❌ Cookie security flags not enforced properly.");
            } else {
                results.push("✅ Cookie security flags enforced.");
            }

            function displayResults() {
                document.getElementById("results").textContent = results.join("\n");
            }

            displayResults();
        })();
    </script>
</body>
</html>
