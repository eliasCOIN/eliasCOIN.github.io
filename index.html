<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Security Sandbox Test</title>
</head>
<body>
  <h1>🔒 Security Sandbox Test Page</h1>
  <p>This page tries to simulate common malicious behaviors. Review what actions succeed or fail.</p>

  <pre id="output"></pre>

  <script>
    const output = document.getElementById("output");

    function log(msg) {
      output.textContent += msg + '\n';
    }

    async function runTests() {
      // Geolocation
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          pos => log("🌍 Geolocation accessed: " + JSON.stringify(pos.coords)),
          err => log("❌ Geolocation blocked: " + err.message)
        );
      } else {
        log("❌ Geolocation API not available");
      }

      // Microphone & Camera
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        log("🎥 Microphone/Camera access SUCCESS");
        stream.getTracks().forEach(track => track.stop());
      } catch (e) {
        log("❌ Microphone/Camera access blocked: " + e.message);
      }

      // Clipboard Read
      try {
        const text = await navigator.clipboard.readText();
        log("📋 Clipboard text read: " + text);
      } catch (e) {
        log("❌ Clipboard read blocked: " + e.message);
      }

      // Permissions Query
      try {
        const permissions = ["geolocation", "microphone", "camera", "clipboard-read", "notifications"];
        for (let name of permissions) {
          const result = await navigator.permissions.query({ name });
          log(`🔍 Permission ${name}: ${result.state}`);
        }
      } catch (e) {
        log("❌ Permissions query failed: " + e.message);
      }

      // Fingerprinting Attempt
      try {
        const fingerprint = {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          languages: navigator.languages,
          screen: {
            width: screen.width,
            height: screen.height,
            colorDepth: screen.colorDepth
          }
        };
        log("🧠 Fingerprint info: " + JSON.stringify(fingerprint));
      } catch (e) {
        log("❌ Fingerprinting blocked: " + e.message);
      }

      // Window top-level navigation test (frame breakout)
      try {
        if (window.top !== window.self) {
          window.top.location = "https://example.com";
          log("🚨 Tried to escape iframe!");
        } else {
          log("✅ Not inside an iframe.");
        }
      } catch (e) {
        log("❌ Frame breakout blocked: " + e.message);
      }

      // Attempt Web Crypto API
      try {
        const key = await crypto.subtle.generateKey(
          { name: "AES-GCM", length: 256 },
          true,
          ["encrypt", "decrypt"]
        );
        log("🔐 Web Crypto API accessible.");
      } catch (e) {
        log("❌ Web Crypto API access blocked.");
      }

      // Notification request
      try {
        const permission = await Notification.requestPermission();
        log("🔔 Notification permission: " + permission);
      } catch (e) {
        log("❌ Notification request failed: " + e.message);
      }
    }

    runTests();
  </script>
</body>
</html>
