<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebView Security Test</title>
    <style>
        body { font-family: Arial, sans-serif; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>WebView Security Test</h1>
    <h3>Results:</h3>
    <pre id="results">Running tests...</pre>
    
    <script>
        (async function() {
            let results = [];

            // 1. Test Camera Access
            try {
                await navigator.mediaDevices.getUserMedia({ video: true });
                results.push("❌ Camera access allowed without explicit user interaction!");
            } catch (e) {
                results.push("✅ Camera access requires user permission.");
            }

            // 2. Clipboard Access
            try {
                let clipboardText = await navigator.clipboard.readText();
                results.push(`❌ Clipboard access allowed! Content: "${clipboardText}"`);
            } catch (e) {
                results.push("✅ Clipboard access blocked or requires user action.");
            }

            // 3. JavaScript Execution & Injection
            try {
                eval("alert('XSS Test')");
                results.push("❌ JavaScript eval() execution allowed, potential XSS risk.");
            } catch (e) {
                results.push("✅ JavaScript eval() execution restricted.");
            }

            // 4. CORS Bypass Test
            try {
                await fetch("https://crossorigin.me/http://example.com");
                results.push("❌ CORS misconfiguration detected!");
            } catch (e) {
                results.push("✅ CORS protection enabled.");
            }

            // 5. User-Agent & Environment Detection
            results.push("User-Agent: " + navigator.userAgent);

            // 6. Cross-Origin Storage Access Test
            try {
                localStorage.setItem("test", "123");
                let storageTest = localStorage.getItem("test");
                results.push(storageTest ? "✅ LocalStorage accessible within same origin: " + storageTest : "✅ LocalStorage access blocked.");
                localStorage.removeItem("test");
            } catch (e) {
                results.push("✅ LocalStorage access blocked.");
            }
            try {
                let iframe = document.createElement('iframe');
                iframe.src = "https://example.com";
                document.body.appendChild(iframe);
                iframe.onload = () => {
                    try {
                        let crossOriginData = iframe.contentWindow.localStorage.getItem("test");
                        results.push(crossOriginData ? "❌ Cross-origin localStorage accessible! This is a security issue." : "✅ Cross-origin localStorage blocked as expected.");
                    } catch (e) {
                        results.push("✅ Cross-origin localStorage access restricted, as expected in secure environments.");
                    }
                    document.body.removeChild(iframe);
                };
            } catch (e) {
                results.push("✅ Cross-origin localStorage test could not be executed.");
            }

            // 7. UXSS Simulation
            try {
                let frame = document.createElement("iframe");
                frame.src = "javascript:alert('UXSS Test')";
                document.body.appendChild(frame);
                results.push("❌ UXSS vulnerability detected! Scripts should not execute across iframes.");
            } catch (e) {
                results.push("✅ UXSS protection enabled.");
            }

            // 8. XSS Detection via DOM Injection
            try {
                let div = document.createElement("div");
                div.innerHTML = "<img src=x onerror=alert('XSS Detected')>";
                document.body.appendChild(div);
                results.push("❌ XSS vulnerability detected via DOM injection! This means JavaScript can execute within injected elements.");
            } catch (e) {
                results.push("✅ DOM-based XSS protection enabled.");
            }

            // 9. Pop-up Handling Test
            try {
                let newWin = window.open("about:blank");
                if (newWin) {
                    results.push("❌ Pop-up allowed without user interaction.");
                } else {
                    results.push("✅ Pop-ups blocked by default.");
                }
            } catch (e) {
                results.push("✅ Pop-up restrictions applied.");
            }

            // 10. Clickjacking Test
            let frameProtection = window.self === window.top;
            results.push(frameProtection ? "✅ Clickjacking protection enabled." : "❌ Clickjacking possible! Frame isolation missing.");

            function displayResults() {
                document.getElementById("results").textContent = results.join("\n");
            }

            displayResults();
        })();
    </script>
</body>
</html>
